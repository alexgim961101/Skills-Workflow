---
name: security-review
description: |
  변경된 코드의 보안 취약점을 OWASP 기반으로 점검하는 스킬.
  코드 리뷰, QA, 외부 입력 처리 코드 변경 시 사용.
  트리거: "보안 점검", "보안 리뷰", "security review", "취약점 점검"
---

# Security Review

## Goal
변경된 코드에 보안 취약점이 없는지 점검하고,
구체적인 수정 방안을 제시합니다.

## Instructions

### Step 1: 보안 범위 판별

변경 코드가 아래 영역에 해당하는지 확인합니다.
**해당 영역만 점검합니다** (불필요한 점검 방지).

| 영역 | 해당 조건 | 점검 대상 |
|------|----------|----------|
| **입력 처리** | 사용자/외부 입력을 받는 코드 | Step 2 |
| **인증/인가** | 로그인, 권한, 토큰, 세션 관련 | Step 3 |
| **데이터 보호** | 개인정보, 민감 데이터, 시크릿 | Step 4 |
| **인프라/설정** | Docker, 환경 변수, CORS, 헤더 | Step 5 |

### Step 2: 입력 검증 (Injection)

- [ ] **SQL Injection**: 문자열 연결로 쿼리 생성하고 있지 않은가? → Parameterized Query 사용
- [ ] **XSS**: 사용자 입력을 HTML에 그대로 렌더링하지 않는가? → 이스케이핑/새니타이징
- [ ] **Command Injection**: 외부 입력이 OS 명령에 포함되지 않는가?
- [ ] **Path Traversal**: 파일 경로에 사용자 입력이 직접 사용되지 않는가?
- [ ] **Deserialization**: 신뢰할 수 없는 데이터를 역직렬화하지 않는가?
- [ ] **입력 검증 위치**: 서버 사이드에서 검증하는가? (클라이언트만으로 불충분)

### Step 3: 인증/인가 (Auth)

- [ ] **인증 우회**: 인증 없이 접근 가능한 엔드포인트가 있지 않은가?
- [ ] **권한 검사**: 리소스 접근 시 소유자/권한을 확인하는가? (IDOR 방지)
- [ ] **토큰 관리**: JWT 서명 검증, 만료 시간 설정, 갱신 토큰 관리가 적절한가?
- [ ] **비밀번호**: 평문 저장 없이 적절한 해싱(bcrypt/argon2)을 사용하는가?
- [ ] **세션 관리**: 세션 고정 공격, 세션 하이재킹 방어가 되어 있는가?

### Step 4: 데이터 보호 (Secrets & PII)

- [ ] **하드코딩된 시크릿**: API 키, 비밀번호, 토큰이 코드에 직접 있지 않은가?
- [ ] **로그 노출**: 비밀번호, 토큰, 개인정보가 로그에 출력되지 않는가?
- [ ] **에러 메시지**: 스택 트레이스나 내부 경로가 사용자에게 노출되지 않는가?
- [ ] **전송 보안**: 민감 데이터가 HTTPS로 전송되는가?
- [ ] **저장 보안**: 민감 데이터가 암호화되어 저장되는가?

### Step 5: 인프라/설정 (Configuration)

- [ ] **CORS**: 허용 Origin이 `*`로 설정되어 있지 않은가?
- [ ] **보안 헤더**: `X-Content-Type-Options`, `X-Frame-Options`, CSP가 설정되어 있는가?
- [ ] **민감 포트**: 디버그 포트, DB 포트가 외부에 노출되지 않는가?
- [ ] **의존성 취약점**: 알려진 CVE가 있는 라이브러리를 사용하고 있지 않은가?

### Step 6: 결과 보고

```
🔒 Security Review

점검 범위: [입력 처리 / 인증 / 데이터 보호 / 인프라] 중 해당 영역

🔴 Critical (즉시 수정 필수):
  - [파일:라인] 취약점 유형: 설명 → 수정 방안

🟠 Warning (수정 권장):
  - [파일:라인] 취약점 유형: 설명 → 수정 방안

✅ 점검 완료: 발견 없음 / N건 발견

판정: ✅ PASS / ❌ FAIL (🔴 Critical 1건 이상이면 FAIL)
```

## Constraints
- 해당 영역만 점검 — 변경과 무관한 영역은 건너뜀
- 🔴 Critical 1건이라도 있으면 FAIL → 수정 후 재점검
- 보안 수정은 기능 테스트 후 적용 (보안 패치가 기능을 깨뜨리지 않도록)
