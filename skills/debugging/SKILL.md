---
name: debugging
description: |
  버그 재현, 근본 원인 분석, 수정 범위 결정을 위한 체계적 디버깅 스킬.
  버그 리포트 대응, 에러 조사, 장애 분석 시 사용.
  트리거: "버그 수정", "에러 분석", "디버깅", "장애 원인", "bug fix"
---

# Debugging

## Goal
버그의 근본 원인을 체계적으로 추적하고,
재현 가능한 증거를 기반으로 수정 범위를 결정합니다.

## Instructions

### Step 1: 증상 정리

버그 리포트 또는 사용자 설명에서 아래를 추출합니다:

- **무엇이**: 어떤 동작/결과가 비정상인가?
- **언제**: 항상? 특정 조건에서만? 최근 배포 이후?
- **어디서**: 어떤 엔드포인트/화면/서비스에서?
- **에러 정보**: 에러 메시지, 스택 트레이스, HTTP 상태 코드, 로그

```
🐛 Bug Summary
증상: [무엇이 어떻게 잘못되는지]
재현 조건: [알려진 조건 / 불명]
에러: [메시지 또는 코드]
최근 변경: [관련 배포/커밋이 있다면]
```

### Step 2: 재현 (Reproduce)

수정 전에 반드시 버그를 재현합니다.

**재현 전략:**

| 상황 | 접근법 |
|------|--------|
| 에러 메시지가 명확 | 에러 발생 코드 위치 직접 추적 |
| 특정 입력에서만 발생 | 해당 입력으로 테스트 케이스 작성 |
| 간헐적 발생 | 로그 분석, 동시성/타이밍 의심 |
| 환경 의존적 | 환경 변수, 설정, 의존성 버전 비교 |

**재현 확인:**
- [ ] 버그를 로컬에서 재현할 수 있는가?
- [ ] 재현 가능한 테스트 케이스를 작성했는가? (실패하는 테스트)

> 재현할 수 없으면 수정하지 않는다. 추가 정보를 사용자에게 요청한다.

### Step 3: 근본 원인 분석 (Root Cause Analysis)

증상이 아닌 **원인**을 찾습니다.

**분석 기법:**

| 기법 | 적용 상황 | 방법 |
|------|----------|------|
| **역추적** | 에러 위치가 명확할 때 | 스택 트레이스에서 위→아래로 호출 체인 추적 |
| **이분 탐색** | 언제부터 깨졌는지 불명확 | `git bisect` 또는 로그 시점별 비교 |
| **가설 검증** | 원인 후보가 여러 개 | 가설 → 로그/코드로 검증 → 배제 반복 |
| **격리** | 복잡한 시스템 | 의존성을 하나씩 제거하며 원인 모듈 특정 |
| **데이터 추적** | 잘못된 결과값 | 입력 → 중간 변환 → 출력 경로에서 값 변질 지점 특정 |

**근본 원인 분류:**

| 유형 | 예시 | 수정 복잡도 |
|------|------|-----------|
| **로직 에러** | 조건문 오류, off-by-one, null 미처리 | 낮음 |
| **상태 문제** | 레이스 컨디션, 캐시 불일치, 세션 오염 | 높음 |
| **데이터 문제** | 잘못된 마이그레이션, 오염된 데이터 | 중간~높음 |
| **환경/설정** | 환경 변수, 버전 불일치, 의존성 충돌 | 낮음 |
| **외부 의존성** | API 변경, 라이브러리 버그, 인프라 장애 | 가변적 |

**출력:**
```
🔍 Root Cause Analysis

원인 유형: [로직 에러 / 상태 문제 / ...]
위치: [파일명:라인] 또는 [모듈/서비스명]
설명: [왜 이 코드가 문제인지 구체적으로]
증거: [재현 테스트, 로그, 코드 경로]
```

### Step 4: 수정 범위 결정

근본 원인을 파악한 후, 수정이 미치는 범위를 평가합니다.

- [ ] 이 수정이 다른 기능에 영향을 주는가?
- [ ] 같은 패턴의 버그가 다른 곳에도 있는가? (Shotgun Fix 필요?)
- [ ] 수정이 API 계약이나 데이터 구조를 변경하는가?

**범위에 따른 분류:**

| 범위 | 기준 | 접근 |
|------|------|------|
| **Isolated** | 단일 파일/함수, 다른 곳에 영향 없음 | 바로 수정 |
| **Spreading** | 같은 패턴이 여러 곳에 존재 | 모든 발생 지점 목록화 후 일괄 수정 |
| **Structural** | 설계 결함이 원인, 리팩터링 필요 | Plan 수립 후 수정 (full-dev-cycle 전환 검토) |

## Constraints
- 재현 없이 수정하지 않음 — "아마 이게 원인일 것이다"로 코드를 바꾸지 않음
- 증상 수정(Symptom Fix)이 아닌 근본 원인 수정(Root Fix)을 목표
- 수정 범위가 Structural이면 사용자에게 알리고 full-dev-cycle 전환 권장
